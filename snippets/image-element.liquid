{% comment %}
  @param alt {String}
    The image alt text

  @param progressive {Boolean}
    If true, image is progressive

  @param stretch_width {Boolean}
    If true, remove the max-width from the image tag

  @param additional_classes {String}
    Additional classes added to the image tag

  @param inline_style {String}
    CSS styles to apply to the image tag's style attribute

  @param back_to_basics {Boolean}
    If true, use standard image tag

  @param focal_point {String}
    The focal point set by the merchant for the image in the Shopify admin
{% endcomment %}

{% liquid
  assign inline_style = inline_style | default: blank
  assign focal_point = focal_point | default: blank
%}

{% if focal_point != blank %}
  {%- capture focal_point_style -%}
    object-fit:cover;object-position:{{ focal_point }};
  {%- endcapture -%}

  {% if inline_style != blank %}
    {% assign inline_style = inline_style | append: focal_point_style %}
  {% else %}
    {% assign inline_style = focal_point_style %}
  {% endif %}
{% endif %}

{% comment %}Check if image is progressive (does not support transparent pngs){% endcomment %}
{% if progressive %}
  {%- capture srcset -%}
    {{ image | img_url: '5000x', format: 'pjpg' }} 5000w,
    {{ image | img_url: '4500x', format: 'pjpg' }} 4500w,
    {{ image | img_url: '4000x', format: 'pjpg' }} 4000w,
    {{ image | img_url: '3500x', format: 'pjpg' }} 3500w,
    {{ image | img_url: '3000x', format: 'pjpg' }} 3000w,
    {{ image | img_url: '2500x', format: 'pjpg' }} 2500w,
    {{ image | img_url: '2000x', format: 'pjpg' }} 2000w,
    {{ image | img_url: '1800x', format: 'pjpg' }} 1800w,
    {{ image | img_url: '1600x', format: 'pjpg' }} 1600w,
    {{ image | img_url: '1400x', format: 'pjpg' }} 1400w,
    {{ image | img_url: '1200x', format: 'pjpg' }} 1200w,
    {{ image | img_url: '1000x', format: 'pjpg' }} 1000w,
    {{ image | img_url: '800x', format: 'pjpg' }} 800w,
    {{ image | img_url: '600x', format: 'pjpg' }} 600w,
    {{ image | img_url: '400x', format: 'pjpg' }} 400w,
    {{ image | img_url: '200x', format: 'pjpg' }} 200w
  {%- endcapture -%}
{% else %}
  {%- capture srcset -%}
    {{ image | img_url: '5000x' }} 5000w,
    {{ image | img_url: '4500x' }} 4500w,
    {{ image | img_url: '4000x' }} 4000w,
    {{ image | img_url: '3500x' }} 3500w,
    {{ image | img_url: '3000x' }} 3000w,
    {{ image | img_url: '2500x' }} 2500w,
    {{ image | img_url: '2000x' }} 2000w,
    {{ image | img_url: '1800x' }} 1800w,
    {{ image | img_url: '1600x' }} 1600w,
    {{ image | img_url: '1400x' }} 1400w,
    {{ image | img_url: '1200x' }} 1200w,
    {{ image | img_url: '1000x' }} 1000w,
    {{ image | img_url: '800x' }} 800w,
    {{ image | img_url: '600x' }} 600w,
    {{ image | img_url: '400x' }} 400w,
    {{ image | img_url: '200x' }} 200w
  {%- endcapture -%}
{% endif %}

{% if back_to_basics %}
  <div
    class="image-element__wrap"
    style="{{ background_color }};"
  >
    <img
      {% if additional_classes %}
        class="{{ additional_classes }}"
      {% endif %}
      src="{{ image | img_url: '2000x' }}"
      alt="{{ alt | escape }}"
      style="{{ inline_style }}"
    >
  </div>
{% else %}
  <div
    class="image-element__wrap"
    style="
      {{ background_color }}
      {% unless stretch_width == true %}
        max-width: {{ image.width }}px;
      {% endunless %}
    "
  >
    <img
      class="
        lazyload
        lazyload--fade-in
        {{ additional_classes }}
      "
      alt="{{ alt | escape }}"
      data-src="{{ image | img_url: '1600x' }}"
      data-sizes="auto"
      data-aspectratio="{{ image.width }}/{{ image.height }}"
      data-srcset="{{ srcset }}"
      style="{{ inline_style }}"
      width="{{ image.width }}"
      height="{{ image.height }}"
      srcset="data:image/svg+xml;utf8,<svg%20xmlns='http://www.w3.org/2000/svg'%20width='{{ image.width }}'%20height='{{ image.height }}'></svg>"
    >
  </div>
{% endif %}

{% comment %}Fallback for no javascript{% endcomment %}
<noscript>
  <img
    class="{{ additional_classes }}"
    src="{{ image | img_url: '2000x' }}"
    alt="{{ alt | escape }}"
    style="{{ inline_style }}"
  >
</noscript>
