{% comment %}
** Product recommendations - dynamic **
- Draggable section
{% endcomment %}

{% comment %} Content settings {% endcomment %}
{%- assign heading = section.settings.product_recommendations_heading -%}
{% comment %} End content settings {% endcomment %}

{% comment %} NE compatibility {% endcomment %}
{% comment %} This setting and conditional should be removed in the New Editor {% endcomment %}
{% if section.settings.show_product_recommendations %}
{% comment %}    Getting all recommendations products.  {% endcomment %}

{% comment %}    Check the product size. If the product size is 0, do not display the section.  {% endcomment %}
{% assign related_product_count  = 0 %}

{% comment %}  custom recommendation products {% endcomment %}
{% assign related_product = product.metafields.custom.recommended.value   %}
 
{% for productmeta in related_product %}
 {% assign related_product_count  = related_product_count | plus: 1 %}
{% endfor %}
  
  
{% comment %} Capturing all html in variable. {% endcomment %}
  {% capture product_collections_markup %}
    <div class="container">
      <div class="one-whole column">
        <h2 class="recommended-title">{{ heading }}</h2>
      </div>
        {% render 'related-product-loop',
                limit: 4,
                products: related_product,
                products_per_row: section.settings.products_per_row,
                skip_product: product
        %}
    </div>
  {% endcapture %}
{% if related_product_count > 0 %}
 <div class="product-recommendations"
       data-recommendations-url="{{ routes.product_recommendations_url }}"
       data-product-id="{{ product.id }}"
       data-limit="{{ section.settings.recommended_products_limit }}"
       data-enabled="{{ section.settings.show_product_recommendations }}">
      {{ product_collections_markup }}
  </div>
{% endif %}

{% comment %} NE compatibility {% endcomment %}
{% comment %} This setting and conditional should be removed in the New Editor {% endcomment %}
{% endif %}
{% comment %} Ends NE compatibility {% endcomment %}

{% schema %}
  {
    "name": "Related products",
    "class": "shopify-section--recommended-products",
    "settings": [
      {
        "type": "checkbox",
        "id": "show_product_recommendations",
        "label": "Show dynamic recommendations",
        "info": "Dynamic recommendations change and improve with time. [Learn more](https://help.shopify.com/en/themes/development/recommended-products)",
        "default": true
      },
      {
        "type": "text",
        "id": "product_recommendations_heading",
        "label": "Heading",
        "default": "You may also like"
      },
      {
        "type": "range",
        "id": "products_per_row",
        "label": "Products per row",
        "min": 2,
        "max": 4,
        "step": 1,
        "default": 3
      },
      {
        "type": "range",
        "id": "recommended_products_limit",
        "label": "Limit products",
        "min": 2,
        "max": 10,
        "step": 1,
        "default": 3
      }
    ]
  }
{% endschema %}
